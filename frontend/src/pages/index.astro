---
import Layout from '../layouts/Layout.astro';
import { fetchHomePage } from '../lib/strapi';

let homePage = null;
let error = null;

try {
  homePage = await fetchHomePage();
} catch (e) {
  error = e.message;
}

const strapiUrl = import.meta.env.STRAPI_URL || 'http://localhost:1337';
const pageTitle = homePage ? homePage.heading : 'Personal Website';
---

<Layout title={pageTitle}>
	{error ? (
		<div class="error">
			<h1>Error loading content</h1>
			<p>{error}</p>
		</div>
	) : homePage ? (
		<div class="container">
			<header class="hero">
				<h1>{homePage.heading}</h1>
				<p class="about">{homePage.aboutBlurb}</p>
			</header>

			{homePage.gallery && homePage.gallery.length > 0 && (
				<section class="gallery">
					<div class="gallery-grid">
						{homePage.gallery.map((image) => (
							<div class="gallery-item">
								<img 
									src={`${strapiUrl}${image.url}`} 
									alt={image.alternativeText || "Gallery image"}
									loading="lazy"
								/>
							</div>
						))}
				</div>
			</section>
			)}

			<footer>
				<p>Built with <strong>Astro</strong> âš¡ and <strong>Strapi</strong> ðŸš€</p>
			</footer>
		</div>
	) : (
		<div class="loading">
			<h1>Loading...</h1>
		</div>
	)}
</Layout>
